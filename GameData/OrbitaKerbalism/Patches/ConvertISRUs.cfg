// Convert ISRUs

// Stock ISRUs
@PART[ISRU,MiniISRU]:HAS[@MODULE[ModuleResourceConverter]]:NEEDS[!Kerbalism] {
	// Determine throughput ratios
	input = #$/MODULE[ModuleResourceConverter]:HAS[@INPUT_RESOURCE:HAS[#ResourceName[Ore]]/INPUT_RESOURCE:HAS[#ResourceName[Ore]]/Ratio$
	@input *= 0.01
	output = #$/MODULE[ModuleResourceConverter]:HAS[@INPUT_RESOURCE:HAS[#ResourceName[Ore]]/OUTPUT_RESOURCE:HAS[#ResourceName[LiquidFuel]]/Ratio$
	@output += #$/MODULE[ModuleResourceConverter]:HAS[@INPUT_RESOURCE:HAS[#ResourceName[Ore]]/OUTPUT_RESOURCE:HAS[#ResourceName[Oxidizer]]/Ratio$
	@output *= 0.005
	// Crystals Processor
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Crystals_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Crystals_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Crystals_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Crystals_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Crystals
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Crystals]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = CarbonDioxide
			Ratio = #$/output$
			@Ratio *= 0.5955
			@Ratio /= #$@RESOURCE_DEFINITION[CarbonDioxide]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/output$
			@Ratio *= 0.2165
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Lithium
			Ratio = #$/output$
			@Ratio *= 0.188
			@Ratio /= #$@RESOURCE_DEFINITION[Lithium]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}

	// Ices Processor
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Ices_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Ices_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Ices_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Ices_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Ices
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Ices]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Water
			Ratio = #$/output$
			@Ratio *= 0.3673
			@Ratio /= #$@RESOURCE_DEFINITION[Water]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = CarbonDioxide
			Ratio = #$/output$
			@Ratio *= 0.299
			@Ratio /= #$@RESOURCE_DEFINITION[CarbonDioxide]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Methane
			Ratio = #$/output$
			@Ratio *= 0.218
			@Ratio /= #$@RESOURCE_DEFINITION[Methane]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Ammonia
			Ratio = #$/output$
			@Ratio *= 0.1157
			@Ratio /= #$@RESOURCE_DEFINITION[Ammonia]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Metallics Processor
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Metallics_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Metallics_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Metallics_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Metallics_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Metallics
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Metallics]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/output$
			@Ratio *= 0.5375
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Silicon
			Ratio = #$/output$
			@Ratio *= 0.2359
			@Ratio /= #$@RESOURCE_DEFINITION[Silicon]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Aluminium
			Ratio = #$/output$
			@Ratio *= 0.2266
			@Ratio /= #$@RESOURCE_DEFINITION[Aluminium]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Rocks Processor
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Rocks_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Rocks_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Rocks_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Rocks_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Rocks
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Rocks]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/output$
			@Ratio *= 0.5324
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Silicon
			Ratio = #$/output$
			@Ratio *= 0.4674
			@Ratio /= #$@RESOURCE_DEFINITION[Silicon]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Uraninite
			Ratio = #$/output$
			@Ratio *= 0.0002
			@Ratio /= #$@RESOURCE_DEFINITION[Uraninite]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	

	
	// Salts Processor
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Salts_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Salts_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Salts_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Salts_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Salts
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Salts]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/output$
			@Ratio *= 0.5997
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Ammonia
			Ratio = #$/output$
			@Ratio *= 0.2128
			@Ratio /= #$@RESOURCE_DEFINITION[Ammonia]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Nitrogen
			Ratio = #$/output$
			@Ratio *= 0.175
			@Ratio /= #$@RESOURCE_DEFINITION[Nitrogen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE {
			ResourceName = Hydrogen
			Ratio = #$/output$
			@Ratio *= 0.126
			@Ratio /= #$@RESOURCE_DEFINITION[Hydrogen]/density$
			DumpExcess = true
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}

	// Petroleum Refinery
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_Petroleum_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_Petroleum_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_Petroleum_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_Petroleum_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Petroleum
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Petroleum]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Kerosene
			Ratio = #$/output$
			@Ratio /= #$@RESOURCE_DEFINITION[Kerosene]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Hydrogen Condenser
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_H2Condenser_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_H2Condenser_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_H2Condenser_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_H2Condenser_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Hydrogen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Hydrogen]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = LqdHydrogen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Hydrogen Evaporator
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_H2Evaporator_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_H2Evaporator_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_H2Evaporator_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_H2Evaporator_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = LqdHydrogen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdHydrogen]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Hydrogen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Hydrogen]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Methane Condenser
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_CH4Condenser_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_CH4Condenser_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_CH4Condenser_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_CH4Condenser_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Methane
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Methane]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = LqdMethane
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdMethane]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Methane Evaporator
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_CH4Evaporator_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_CH4Evaporator_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_CH4Evaporator_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_CH4Evaporator_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = LqdMethane
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdMethane]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Methane
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Methane]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Oxygen Condenser
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_O2Condenser_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_O2Condenser_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_O2Condenser_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_O2Condenser_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = LqdOxygen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	
	// Oxygen Evaporator
	+MODULE[ModuleResourceConverter],0 {
		@ConverterName = #OrbitaLoc_ISRU_O2Evaporator_ConverterName
		@StartActionName = #OrbitaLoc_ISRU_O2Evaporator_StartActionName
		@StopActionName = #OrbitaLoc_ISRU_O2Evaporator_StopActionName
		@resourceOutputName = #OrbitaLoc_ISRU_O2Evaporator_resourceOutputName
		!INPUT_RESOURCE:HAS[#ResourceName[*]] {}
		!OUTPUT_RESOURCE:HAS[#ResourceName[*]] {}
		INPUT_RESOURCE {
			ResourceName = LqdOxygen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[LqdOxygen]/density$
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE {
			ResourceName = ElectricCharge
			Ratio = 30
		}
		OUTPUT_RESOURCE {
			ResourceName = Oxygen
			Ratio = #$/input$
			@Ratio /= #$@RESOURCE_DEFINITION[Oxygen]/density$
			DumpExcess = false
			FlowMode = STAGE_PRIORITY_FLOW
		}
	}
	!MODULE[ModuleResourceConverter]:HAS[@INPUT_RESOURCE:HAS[#ResourceName[Ore]]] {}
}